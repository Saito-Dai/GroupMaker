# グループ編成ジェネレータ（C#/.NET）

## 目的
教授が講義内でのグループワークのために、グループ分けの方法を募っていたため、情報学部らしく提案します。
## 仕様
クラス人数 N 人を、4〜6人のサイズ制約を守りつつ、おおむね5人組を基本にして R ラウンド分グルーピングします。
過去に出た完全一致グループや、6人組に含まれる任意の5人（= 5-core）の再出現を抑制するロジックを備えています。衝突が残る場合はローカルスワップで修復を試み、解消できなければ最小衝突案で実行します（ベストエフォート設計）。
## 使い方

### 必要環境

* .NET SDK 6 以降（`dotnet --version` で確認）

### 実行（コンソール入力方式）

本ツールは **コンソールから N・R・seed を入力**する方式です。
未入力のときは **N=54 / R=3 / seed=ランダム** を採用します。

```bash
dotnet run
```

実行後のプロンプト例:

```
=== グループ編成ジェネレータ ===
人数(N)・ラウンド数(R)・乱数シード(seed)を順に入力してください。
※ EnterだけでN=54, R=3、seedはランダムになります。

人数 N (3以上推奨) [既定=54]: 31
ラウンド数 R (1以上) [既定=3]: 3
乱数シード seed（未入力=ランダム）[例: 12345]: 42
```

### 出力例

```
=== Round 1 ===
 G1: [ 1,  4,  9, 12, 27] (人数=5)
 G2: [ 2, 10, 15, 19, 23] (人数=5)
 ...
 
=== Round 2 ===
 G1: [ 3,  5,  8, 14, 26, 31] (人数=6)
 ...

=== Round 3 ===
 ...
```

> メモ：コード内コメントに **コマンドライン引数で渡す例**（`dotnet run -- 31 3 42`）が残っていますが、**現在の実装はコンソール入力のみ**を使用します。必要なら切り替え可能です（下記参照）。

---

## 仕様概要

### 入力

* **N**：人数（`N ≥ 3` 推奨）
* **R**：ラウンド数（`R ≥ 1`）
* **seed**（任意）：乱数シード（同じ seed で再現可能）

### 出力

* 各ラウンドのグループ集合
* 各グループは **4〜6人**、表示は**昇順**＋**人数**付き

### グループ分割ルール（5人基準 & 余り処理）

1. メンバー ID（1..N）を **Fisher–Yates** でシャッフル
2. **5人ずつ**切り出し、**余り**を次のルールで処理

| 余り人数  | 処理                                     |
| ----- | -------------------------------------- |
| 0     | 何もしない                                  |
| 1 / 2 | 既存5人組へ**均等合流**（6人超は不可。満杯時は救済で新規3人組を作成） |
| 3 / 4 | 余りのみで**独立グループ**                        |
| 8 / 9 | **5人 + (3 or 4)** に分割（安全弁）             |
| その他   | **3〜6人**に収まるよう**貪欲**にまとめる              |

* 余り合流の開始位置は**ラウンドごとにローテーション**して偏りを抑制。

### 再出現の抑制（履歴チェック）

* **完全一致グループ**の再出現を禁止（`_historyExact`）
* **6人組**では、その中の任意の5人（6通り）のいずれかが過去の**5人組**と一致する場合を禁止（`_historyFiveCore` = **5-core**抑止）

### 衝突の修復（ローカルスワップ）

* 衝突（サイズ違反/履歴衝突）検出後、**ランダム1人交換**を最大20回試行
* **悪化しない**スワップのみ採用する**簡易山登り法**
* 解消できない場合は、試行中の**最小衝突案**を採用

### 再現性

* **seed を指定**すると同じ結果を再現できます（授業配布・検証に便利）
* **seed 未入力**は毎回ランダム

---

## プロジェクト構成（主要クラス）

* `Program`
  コンソール入出力。`GroupAssignmentGenerator` を呼び出し、結果を整形表示。
* `GroupAssignmentGenerator`
  シャッフル、5人基準の分割、余り処理、履歴保存、衝突検出、ローカルスワップ修復を実装。

---

## ビルド

```bash
dotnet build
```

---

## テクニカルノート

* **シャッフル**：Fisher–Yates（全順列等確率）
* **キー正規化**：昇順ソート → 2桁ゼロ埋め → `-` 連結（例：`[3,10,2] -> "02-03-10"`）
* **計算量の目安**：

  * シャッフル：O(N)
  * 履歴チェック：グループ数×（最大6通り）程度のキー生成＋ `HashSet` 照会
  * ローカルスワップ：最大20回の試行（クラス規模：数十人を想定）

---

## 既知の制約 / ベストエフォート

* 制約が過密（例：小人数でラウンドが多い等）の場合、**衝突を完全に排除できない**ことがあります。
  その際は **最小衝突案**で出力します。再実行や seed の変更で改善することがあります。
* 5-core 抑止は**6人組と5人組の関係**に着目した実践的ヒューリスティックです。厳密最適化ではありません。

---

## 貢献

Issue/PR 歓迎です。再現用に **N / R / seed / 出力例** を添付いただけると助かります。
